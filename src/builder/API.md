# API Documentation

## OpenRTB version 2.6

### BidRequestBuilder

A builder for constructing OpenRTB 2.6 bid request objects.

#### Import

```typescript
import { BidRequestBuilder } from "@nextad/builder/v26";
```

#### Constructor

```typescript
const builder = new BidRequestBuilder();
```

#### Methods

##### Top-level parameters

- withId(id: string): Sets the bid request ID (automatically generated using UUID if not specified)
- withTest(test: 0 | 1): Sets the test mode flag
- withAuctionType(at: number): Sets the auction type
- withAllImps(allimps: 0 | 1): Sets the all impressions flag.
- withCurrencies(cur: string[]): Sets the accepted currencies
- withWhitelistedSeats(wseat: string[]): Sets the list of allowed buyer seats
- withBlockedSeats(bseat: string[]): Sets the list of blocked buyer seats

##### Object parameters

- withSite(site: Partial<SiteV26>): Sets the site object.
- withApp(app: Partial<AppV26>): Sets the app object.
- withDOOH(dooh: Partial<DOOHV26>): Sets the dooh object.
- withDevice(device: Partial<DeviceV26>): Sets the device object.
- withUser(user: Partial<UserV26>): Sets the user object.
- withSource(source: Partial<SourceV26>): Sets the source object.
- withRegulations(regs: Partial<RegsV26>): Sets the regulation object.
- withGeo(geo: Partial<GeoV26>): Sets the geo object. (device.geo)

##### Impression management

- withCommonImp(props: Partial<ImpV26>): Sets the common parameters for all impression
- addImp(props?: Partial<ImpV26>): Adds a new impression object (properties are optional)

##### build

- build(): Returns the final bid request.
- reset(): Resets the instance

#### Usage

```typescript
const request = new BidRequestBuilder()
  .withId("request-1")
  .withTimeout(500)
  .withSite({
    id: "site1",
    domain: "example.com",
  })
  .withCommonImp({
    secure: 1,
    bidfloor: 1.0,
    bidfloorcur: "USD",
  })
  .addImp({
    banner: {
      w: 300,
      h: 250,
    },
  })
  .build();
```

### BidRequestBuilderDecorator

#### Import

```typescript
import { BidRequestBuilderDecorator } from "@nextad/builder/v26";
// By extending the base decorator, you can implement specialized functionality.
// import { Imp } from 'iab-openrtb/v26';
```

#### Usage

In most cases, you should import the OpenRTB v2.6 type definitions along with it.

```typescript
import { BidRequestBuilderDecorator } from "@nextad/builder/v26";
import { Imp } from "iab-openrtb/v26";

class DV360BidRequestDecorator extends BidRequestBuilderDecorator {
  public withExt(ext: Record<string, unknown>): this {
    return super.withExt({
      ...ext,
      google: {
        billing_id: "123456789",
        publisher_id: "pub-1234567890",
      },
    });
  }

  public addImp(props?: Partial<Imp>): this {
    return super.addImp({
      ...props,
      ext: {
        ...props?.ext,
        google: {
          slot_visibility: "ABOVE_THE_FOLD",
        },
      },
    });
  }
}

const dv360Builder = new DV360BidRequestDecorator(new BidRequestBuilder());
const dv360Request = dv360Builder
  .withId("request-1")
  .withSite({
    id: "site1",
    domain: "example.com",
  })
  .addImp({
    banner: {
      w: 300,
      h: 250,
    },
  })
  .build();
```

### BidResponseBuilder

A builder for constructing OpenRTB 2.6 bid response objects.

#### Import

```typescript
import { BidResponseBuilder } from "@nextad/builder/v26";
```

#### Constructor

```typescript
const builder = new BidResponseBuilder();
```

#### Methods

##### Top-level parameters

- withId(id: string): Sets the bid response ID (automatically generated using UUID if not specified)
- withBidId(bidid: string): Sets the response ID generated by the bidder
- withCurrency(cur: string): Sets the bid currency
- withCustomData(customdata: string): Sets custom data for cookies
- withNoBidReason(nbr: number): Sets the reason for no bid
- withExt(ext: Record<string, unknown>): Sets extension data

##### Seat Bid Management

- beginSeatBid(seat?: string): Starts a new seat bid section
- withGroup(group: 0 | 1): Sets the group flag for the current seat bid
- withCommonBid(props: Partial<BidV26>): Sets common properties for all bids in the current seat bid

##### Bid Management

- addBid(props: Partial<BidV26> & { impid: string; price: number }): Adds a new bid
- addBannerBid(props: Partial<BidV26> & { impid: string; price: number }): Adds a new banner ad bid
- addVideoBid(props: Partial<BidV26> & { impid: string; price: number }): Adds a new video ad bid
- addAudioBid(props: Partial<BidV26> & { impid: string; price: number }): Adds a new audio ad bid
- addNativeBid(props: Partial<BidV26> & { impid: string; price: number }): Adds a new native ad bid

##### Build

- build(): Returns the final BidResponse object
- reset(): Resets the instance

#### Usage

```typescript
const response = new BidResponseBuilder()
  .withId("response-1")
  .withCurrency("USD")
  .beginSeatBid("seat1")
  .withCommonBid({
    adomain: ["advertiser.com"],
    cat: ["IAB1"],
  })
  .addBannerBid("imp1", 3.5, "<creative>", {
    w: 300,
    h: 250,
  })
  .build();
```

### BidResponseBuilderDecorator

#### Import

```typescript
import { BidResponseBuilderDecorator } from "@nextad/builder/v26";
// By extending the base decorator, you can implement specialized functionality.
// import { Bid } from 'iab-openrtb/v26';
```

#### Usage

In most cases, you should import the OpenRTB v2.6 type definitions along with it.

```typescript
import { BidResponseBuilderDecorator } from "@nextad/builder/v26";
import { Bid } from "iab-openrtb/v26";

class TTDBidResponseDecorator extends BidResponseBuilderDecorator {
  public addBid(
    props: Partial<BidV26> & { impid: string; price: number }
  ): this {
    return super.addBid({
      ...props,
      ext: {
        ...props.ext,
        ttd: {
          advertiser_id: "ttd-adv-123",
          campaign_id: "ttd-camp-456",
        },
      },
    });
  }
}

const ttdBuilder = new TTDBidResponseDecorator(new BidResponseBuilder());
const ttdResponse = ttdBuilder
  .withId("response-1")
  .withCurrency("USD")
  .beginSeatBid("ttd-seat")
  .addBannerBid({
    impid: "imp1",
    price: 3.5,
    adm: "<creative>",
  })
  .build();
```